(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function e(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(o){if(o.ep)return;o.ep=!0;const s=e(o);fetch(o.href,s)}})();const z=document.getElementsByClassName("error-notifs")[0];function h(t,n){const e=document.createElement("div");return e.innerHTML=`${t?`<b>${t}: </b>`:""}${n}`,z.appendChild(e),setTimeout(()=>{e.remove()},6666),new Error(n)}const v=document.getElementById("ah-popup"),R=document.getElementById("ah-progress-label"),W=document.getElementById("ah-progress"),x="https://api.hypixel.net/v2/skyblock/auctions",D=await(await fetch("reforges.json")).json(),Z=["✪","⚚"];async function C(t){return await(await fetch(`${x}?page=${t}`)).json()}function J(t){for(const n of D)t.startsWith(n)&&(t=t.slice(n.length));for(const n of Z)t.replace(n,"");return t=t.replace(/\[Lvl \d+?\]/g,""),t.trim()}async function U(){v.style.display=null;const t={generated_at:Date.now(),items:{}},n=await C(0);if(!n.success)throw h("Auctions",n.cause);for(let e=0;e<n.totalPages;e++){R.textContent=`${e+1} / ${n.totalPages}`;const a=e===0?n:await C(e);if(!a.success){h("Auctions",a.cause);continue}const o=Date.now();for(const s of a.auctions){if(!s.bin||s.end<o)continue;(!t.items[s.item_name]||s.starting_bid<t.items[s.item_name])&&(t.items[s.item_name]=s.starting_bid);const r=J(s.item_name);(!t.items[r]||s.starting_bid<t.items[r])&&(t.items[r]=s.starting_bid)}W.style.width=`${(e+1)/n.totalPages*100}%`}return v.style.display="none",t}const P=document.getElementById("bz-popup"),Y="https://api.hypixel.net/v2/skyblock/bazaar";async function G(){P.style.display=null;const t={generated_at:Date.now(),products:{}},e=await(await fetch(Y)).json();if(!e.success)throw h("Bazaar",e.cause);return t.products=e.products,P.style.display="none",t}function K(t){const n=t.match(/(\d+)d/)?.[0]||"0",e=t.match(/(\d+)h/)?.[0]||"0",a=t.match(/(\d+)m/)?.[0]||"0",o=t.match(/(\d+)s/)?.[0]||"0";return parseInt(n)*86400+parseInt(e)*3600+parseInt(a)*60+parseInt(o)}function B(t){t=Math.round(t);const n=Math.floor(t/86400),e=Math.floor(t%86400/3600),a=Math.floor(t%3600/60),o=t%60;return`${n?n+"d ":""}${e?e+"h ":""}${a?a+"m ":""}${o?o+"s ":""}`.trim()}function Q(t,n,e,a,o){const s=new Map,r=new Map;let y=0,l=0,f=0;function w(p,_=1,u=-1){u=u<=0?u:u-1;const{input:d,time:S}=e[p];for(const[c,I]of Object.entries(d)){const i=I*_;if(y+=K(S)*_,s.set(c,(s.get(c)||0)+i),c in e){if(u>0||u===-1){w(c,i,u);continue}const g=e[c].ref;if(g.startsWith("BZ")){const E=g.slice(3),F=o.products[E];if(!F){h("Material",`Could not find product ${E} in bazaar data.`);continue}const A=F.quick_status.buyPrice*i,k=F.quick_status.sellPrice*i;r.set(c,(r.get(c)||0)+A),l+=A,f+=k;continue}const m=a.items[g];if(!m){h("Material",`Could not find item ${g} in auction data.`);continue}r.set(c,(r.get(c)||0)+m*i),l+=m*i,f+=m*i;continue}if(c.startsWith("COINS")){r.set(c,(r.get(c)||0)+i),l+=i,f+=i;continue}if(c.startsWith("BZ")){const g=c.slice(3),m=o.products[g];if(!m){h("Material",`Could not find product ${g} in bazaar data.`);continue}const E=m.quick_status.buyPrice*i,F=m.quick_status.sellPrice*i;r.set(c,(r.get(c)||0)+E),l+=E,f+=F;continue}const b=a.items[c];if(!b){c.startsWith("NULL")||h("Material",`Could not find item ${c} in auction data.`);continue}r.set(c,(r.get(c)||0)+b*i),l+=b*i,f+=b*i}}w(t,1,n);for(const[p,_]of r)r.set(p,Math.ceil(_));return{net_materials:s,independent_cost:r,net_seconds:y,net_bin_cost:l,net_order_cost:f}}const V=document.getElementById("forge-items"),q=document.getElementById("pref-depth"),X=document.getElementById("res-img"),N=document.getElementById("res-item"),tt=document.getElementById("res-hotm"),O=document.getElementById("res-profit"),j=document.getElementById("res-mats"),T=document.getElementById("res-time"),et={COMMON:"#ffffff",UNCOMMON:"#55FF55",RARE:"#5555FF",EPIC:"#AA00AA",LEGENDARY:"#FFAA00",MYTHIC:"#FF55FF",SPECIAL:"#FF5555"};let H=null;const $=await(await fetch("forge.json")).json();for(const t in $){let n=function(){H=n,X.setAttribute("src",e.img),N.textContent=t,N.style.color=a,tt.textContent=`HOTM: ${e.hotm}`,O.innerHTML="",j.innerHTML="",T.innerHTML="";const s=parseInt(q.value),{net_materials:r,independent_cost:y,net_seconds:l,net_bin_cost:f,net_order_cost:w}=Q(t,s,$,M,L);for(const[d,S]of r){const c=d.startsWith("NULL")?"Other":d==="COINS"?"":y.has(d)?d.startsWith("BZ")?"Bazaar":"Auction":"Forge",I=d.replace("BZ:","").replace("NULL:",""),i=y.has(d)?y.get(d)?.toLocaleString():"";j.insertAdjacentHTML("beforeend",`<tr${c==="Forge"?' style="color: #5555FF"':c==="Other"?' style="color: #FF5555"':""}><td>${c}</td><td>${I}</td><td>${S.toLocaleString()}</td><td>${i}</td></tr>`)}for(let d=1;d<=7;d++){const I=B(Math.ceil(l/d)),i=B(Math.ceil(l*.7/d)),b=B(Math.ceil(l*.45/d));T.insertAdjacentHTML("beforeend",`<tr><td>${d}</td><td>${I}</td><td>${i}</td><td>${b}</td></tr>`)}const p=Math.floor($[t].ref.startsWith("BZ")?L.products[$[t].ref.slice(3)].quick_status.sellPrice:M.items[$[t].ref.replace(" Pet","")]),_=p-Math.ceil(f),u=p-Math.ceil(w);O.insertAdjacentHTML("beforeend",`<tr><td>Sell Price</td><td>${p.toLocaleString()}</td><td></td></tr>`),O.insertAdjacentHTML("beforeend",`<tr><td>Instant Buy</td><td>${Math.ceil(f).toLocaleString()}</td><td style="color: ${_>0?'#55FF55">+':'#FF5555">'}${_.toLocaleString()}</td></tr>`),O.insertAdjacentHTML("beforeend",`<tr><td>Buy Order</td><td>${Math.ceil(w).toLocaleString()}</td><td style="color: ${u>0?'#55FF55">+':'#FF5555">'}${u.toLocaleString()}</td></tr>`)};const e=$[t],a=et[e.rarity];if(e.hotm===-1)continue;const o=document.createElement("div");o.classList.add("tooltip-hover-right"),o.innerHTML=`<img src="${e.img}"><div class="tooltip mc-font"><p style="color: ${a}">${t}</p><p style="color: ${a};"><b>${e.rarity}</b></p></div>`,V.appendChild(o),o.addEventListener("click",n)}q.addEventListener("input",()=>H?.());let M=JSON.parse(localStorage.getItem("auction_data")||"{}"),L=JSON.parse(localStorage.getItem("bazaar_data")||"{}");(!M.items||M.generated_at+6e5<Date.now())&&(M=await U(),localStorage.setItem("auction_data",JSON.stringify(M)));(!L.products||L.generated_at+6e4<Date.now())&&(L=await G(),localStorage.setItem("bazaar_data",JSON.stringify(L)));
